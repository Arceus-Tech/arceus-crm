{% load app_filters %}
<form action="{% url 'leads:bulk-assign' %}" method="post">
  {% csrf_token %}
  {% if request.user.UserPosition.name != "Agent" %}
  <div class="w-full mb-5 flex justify-between items-center">
    <h2 class="text-3xl font-bold dark:text-white ">Leads</h2>
    <div class="flex">
      <button id="agentAssign" data-dropdown-toggle="agentAssignHover"
      class="inline-flex items-center py-2 px-5 text-sm font-medium text-gray-900 focus:outline-none bg-white rounded-l-lg border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-600  dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700"
        type="button">Agents<svg class="ml-2 w-4 h-4" aria-hidden="true" fill="none" stroke="currentColor"
          viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 9l-7 7-7-7"></path>
        </svg></button>

      <!-- Dropdown menu -->
      <div id="agentAssignHover" class="hidden z-10 w-48 bg-white rounded shadow ">
        <ul class="p-3 space-y-1 text-xs text-gray-700" aria-labelledby="agentAssignButton">
          <li>
            <div class="flex items-center p-2 rounded hover:bg-gray-100 ">
              <input id="unassign" type="radio" value="Unassign" name="agent_id"
                class="w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 ">
              <label for="unassign" class="ml-2 w-full text-xs font-normal text-gray-900 rounded ">
                Unassign</label>
            </div>
          </li>
          {% for agent in agents %}

          <li>
            <div class="flex items-center p-2 rounded hover:bg-gray-100 ">
              <input id="{{ agent.user.id }}" type="radio" value="{{ agent.user.id }}" name="agent_id"
                class="w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 ">
              <label for="{{ agent.user.id }}" class="ml-2 w-full text-xs font-normal text-gray-900 rounded ">
                {{ agent.user }}</label>
            </div>
          </li>
          {% endfor%}

        </ul>
      </div>

      <button id="noteAssignButton" data-dropdown-toggle="noteAssignButtonHover"
      class="inline-flex items-center py-2 px-5 text-sm font-medium text-gray-900 focus:outline-none bg-white border border-gray-200 hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-600  dark:bg-gray-800 dark:text-gray-400 dark:border-gray-600 dark:hover:text-white dark:hover:bg-gray-700"
        type="button">Status<svg class="ml-2 w-4 h-4" aria-hidden="true" fill="none" stroke="currentColor"
          viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 9l-7 7-7-7"></path>
        </svg></button>


      <!-- Dropdown menu -->
      <div id="noteAssignButtonHover" class="hidden z-10 w-48 bg-white rounded shadow ">
        <ul class="p-3 space-y-1 text-xs text-gray-700" aria-labelledby="noteAssignButton">
          <li>
            <div class="flex items-center p-2 rounded hover:bg-gray-100 ">
              <input id="fresh" type="radio" value="Fresh" name="note_id"
                class="w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 ">
              <label for="fresh" class="ml-2 w-full text-xs font-normal text-gray-900 rounded ">
                Fresh</label>
            </div>
          </li>
          {% for note in statuses %}
          
          
          <li>
            <div class="flex items-center p-2 rounded hover:bg-gray-100 ">
              <input id="{{ note.pk }}" type="radio" value="{{ note.pk }}" name="note_id"
                class="w-4 h-4 text-blue-600 bg-gray-100 rounded border-gray-300 focus:ring-blue-500 ">
              <label for="{{ note.pk }}" class="ml-2 w-full text-xs font-normal text-gray-900 rounded ">
                {{ note.name }}</label>
            </div>
          </li>
          {% endfor%}

        </ul>
      </div>
      <button type="submit"
        class="py-1.5 px-3 text-SM font-medium text-center text-white bg-blue-700 rounded-R-lg hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 ">Bulk
        Assign</button>
    </div>


  </div>
  {% endif %}




  <nav class="flex justify-between items-center w-full py-4" aria-label="Table navigation">
        <span class="block text-sm text-gray-700 dark:text-gray-400">
          Showing <span class="font-semibold text-gray-900 dark:text-white">{{page_obj.number }} page</span> of <span class="font-semibold text-gray-900 dark:text-white">{{ page_obj.paginator.num_pages }}
      </span></span>
      <span class="block text-sm text-gray-700 dark:text-gray-400">
        Showing <span class="font-semibold text-gray-900 dark:text-white">{{ page_obj.start_index}}</span> to <span class="font-semibold text-gray-900 dark:text-white">{{ page_obj.end_index }} of {{ page_obj.paginator.count }} | {{ page_obj.end_index|sub:page_obj.start_index}}
    </span></span>

    
    <ul class="inline-flex items-center -space-x-px">
      {% if page_obj.has_previous %}
      <li>
        {% if 'filter' in request.GET %}
        <a href="{{ request.get_full_path }}&page={{ page_obj.previous_page_number }}"
          class="block px-3 py-2 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
          {% else %}
          <a href="?page={{ page_obj.previous_page_number }}"
          class="block px-3 py-2 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
          {% endif %}
          <span class="sr-only">Previous</span>
          <svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd"
              d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z"
              clip-rule="evenodd"></path>
          </svg>
        </a>
      </li>
      {% endif %}
      {% if page_obj.has_next %}
      <li>
        {% if 'filter' in request.GET %}
        <a href="{{ request.get_full_path }}&page={{ page_obj.next_page_number }}"
        class="block px-3 py-2 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
        {% else %}  
        <a href="?page={{ page_obj.next_page_number }}"
        class="block px-3 py-2 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
        {% endif %}
        <span class="sr-only">Next</span>
          <svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 20 20"
            xmlns="http://www.w3.org/2000/svg">
            <path fill-rule="evenodd"
              d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
              clip-rule="evenodd"></path>
          </svg>
        </a>
      </li>
      {% endif %}
    </ul>
  </nav>

  {% if leads %}
  <div class="overflow-x-auto relative shadow-md sm:rounded-lg">
    <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
      <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
        <tr>
          <th scope="col" class="p-4 text-center">
            <div class="flex items-center">
              <input id="checkbox-all-search" type="checkbox"
                class="all-check w-4 h-4 border border-gray-300 rounded bg-gray-50 focus:ring-3 focus:ring-blue-300 dark:bg-gray-700 dark:border-gray-600 dark:focus:ring-blue-600 dark:ring-offset-gray-800 ">
              <label for="checkbox-all-search" class="sr-only">checkbox</label>
            </div>
          </th>
          
          <th scope="col" class="py-3 px-6 text-center">
            Name
          </th>
          <th scope="col" class="py-3 px-6 text-center">
            Email
          </th>
          <th scope="col" class="py-3 px-6 text-center">
            Phone Number
          </th>
          {% if request.user.UserPosition.name != "Agent" %}
          <th scope="col" class="py-3 px-6 text-center">
            Agent
          </th>
          {% endif %}
          <th scope="col" class="py-3 px-6 text-center">
            Source
          </th>

          <th scope="col" class="py-3 px-6 text-center">
            Status
          </th>
          <th scope="col" class="py-3 px-6 text-center">
            Last Contacted
          </th>
          <th scope="col" class="py-3 px-6 text-center">
            Uploaded on
          </th>

        </tr>
      </thead>
      <tbody>
        {% for lead in leads %}
        <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
          <td class="p-4 w-4 text-center">
            <div class="flex items-center">
              <input id="checkbox-table-search-1" type="checkbox" value="{{ lead.pk }}" name="lead_id"
                class=" id-check w-4 h-4 border border-gray-300 rounded bg-gray-50 focus:ring-3 focus:ring-blue-300 dark:bg-gray-700 dark:border-gray-600 dark:focus:ring-blue-600 dark:ring-offset-gray-800 ">
              <label for="checkbox-table-search-1" class="sr-only">checkbox</label>
            </div>
          </td>
          <td class="py-2 px-6 mx-auto text-center max-w-5 ">
            <a href="{% url 'leads:lead-detail' lead.id %}">{{ lead.lead_name}}</a>
          </td>
          <td class="py-2 px-6 mx-auto truncate max-w-3 text-center">
            <span class=" cursor-pointer" onclick="selectElementContents(this)">{{ lead.email }}</span>
          </td>
          <td class="py-2 px-6 mx-auto  text-center">
            <span class=" cursor-pointer" onclick="selectElementContents(this)">{{ lead.phone_number}}</span>
          </td>
          {% if request.user.UserPosition.name != "Agent" %}
          <td class="py-2 px-6 mx-auto max-w-3  truncate text-center">
            {% if lead.agent %}
            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
              {{ lead.agent.user.first_name}}
            </span>

            {% else %}
            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
              Unassigned
            </span>
            {% endif %}

          </td>
          {% endif %}
          <td class="py-2 px-6 mx-auto max-w-20 truncate text-center">
            {{ lead.campaign.name}}
          </td>
          <td class="py-2 px-6 mx-auto max-w-20 font-medium  truncate text-center">
            <a href="{% url 'leads:update-comment' lead.pk %}">
              {% if lead.status.name == "Follow up" %}
              <span class="bg-blue-100 text-blue-800 text-sm  px-2 py-0.5 rounded ">
                {{lead.status.name}}
              </span>

              {% elif lead.status.name == "No Answer" %}
              <span class="bg-red-100 text-red-800 text-sm  px-2 py-0.5  rounded">
                {{lead.status.name}}
              </span>

              {% elif lead.status.name == "Call Back" %}
              <span class="bg-yellow-100 text-yellow-800 text-sm  px-2 py-0.5  rounded">
                {{lead.status.name}}
              </span>

              {% elif lead.status.name == "Not interested" %}
              <span class="bg-purple-100 text-purple-800 text-sm  px-2 py-0.5  rounded">
                {{lead.status.name}}
              </span>

              {% elif lead.status.name == "Hindi" %}
              <span class="bg-pink-100 text-pink-800 text-sm  px-2 py-0.5  rounded">
                {{lead.status.name}}
              </span>


              {% elif not lead.status %}
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                Fresh
              </span>

              {% else %}
              <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                {{lead.status.name}}
              </span>

              {% endif %}
            </a>
          </td>
          
          <td scope="row" class="py-4 px-6 font-medium text-gray-900 text-center whitespace-nowrap ">
            {% if lead.last_updated %}
            <span class="bg-blue-100 text-blue-800 text-sm  px-2 py-0.5 rounded dark:bg-blue-200 dark:text-blue-800">
              {{ lead.last_updated|date:"d M f A"}}
            </span>
            {%else%}
          <span class="bg-blue-100 text-blue-800 text-sm  px-2 py-0.5 rounded dark:bg-blue-200 dark:text-blue-800">
            Not Contacted
          </span>
          {% endif %}
          </td>

          <td class="py-2 px-6 mx-auto max-w-3  truncate text-center">
            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
              {{ lead.campaign.uploaded_at|date:"d M f A"}}
            </span>
          </td>


        </tr>
        {% endfor%}
      </tbody>
    </table>
  </div>
  {% else %}
  <div id="alert-additional-content-4" class="p-4 mb-4 border border-yellow-300 rounded-lg bg-yellow-50 dark:bg-yellow-200" role="alert">
    <div class="flex items-center">
      <svg aria-hidden="true" class="w-5 h-5 mr-2 text-yellow-700 dark:text-yellow-800" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg>
      <span class="sr-only">Info</span>
      <h3 class="text-lg font-medium text-yellow-700 dark:text-yellow-800">Oops! Leads not Found.</h3>
    </div>
    <div class="mt-2 mb-4 text-sm text-yellow-700 dark:text-yellow-800">
      Leads tagged with the user's name produce no results. To assign leads, kindly get in touch with your team leader. Contact the IT department if the issue persists.
    </div>
    <div class="flex">

      <button type="button" class="text-yellow-700 bg-transparent border border-yellow-700 hover:bg-yellow-800 hover:text-white focus:ring-4 focus:outline-none focus:ring-yellow-300 font-medium rounded-lg text-xs px-3 py-1.5 text-center dark:border-yellow-800 dark:text-yellow-800 dark:hover:text-white" data-dismiss-target="#alert-additional-content-4" aria-label="Close">
        Dismiss
      </button>
    </div>
  </div>
  {% endif %}
</form>